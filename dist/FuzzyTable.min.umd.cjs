(function(g,m){typeof exports=="object"&&typeof module<"u"?module.exports=m():typeof define=="function"&&define.amd?define(m):(g=typeof globalThis<"u"?globalThis:g||self,g.FuzzyTable=m())})(this,function(){"use strict";var R=Object.defineProperty;var V=(g,m,w)=>m in g?R(g,m,{enumerable:!0,configurable:!0,writable:!0,value:w}):g[m]=w;var C=(g,m,w)=>V(g,typeof m!="symbol"?m+"":m,w);function g(e,t){const a=t.id,n=e.sortedCol===a;return e.sortedCol=n?"":a,t.type==="int"||t.type==="year"||t.type==="bool"?e.table.sort((s,r)=>{const o=s[a]!==void 0&&s[a]!==null?Number(s[a]):-1/0,l=r[a]!==void 0&&r[a]!==null?Number(r[a]):-1/0;return n?l-o:o-l}):e.table.sort((s,r)=>{const o=s[a]??"",l=r[a]??"";return n?l.localeCompare(o):o.localeCompare(l)})}const m=(e,t)=>{const a=(l,d)=>[(l+1)*d-d,(l+1)*d],[n,s]=a(e.currentPage,e.size),r=e.table.slice(n,s);t.innerHTML="";let o=n+1;for(const l of r){const d=document.createElement("tr");if(d.className=e.classes.tr,e.numberCol){const i=document.createElement("td");i.className=`${e.classes.tableColumn??""} number-column`,i.textContent=o++,d.appendChild(i)}for(const i of e.head){const c=document.createElement("td");c.className=`${i.class??""} ${i.id} ${e.classes.tableColumn??""}`,i.type&&c.setAttribute("data-type",i.type);const h=l[i.id]??"",b=D(e,h,i.type,e.locale),p=new DocumentFragment;if(i.icon&&p.appendChild(w(i.icon,l[i.icon.id]??"")),i.img&&p.appendChild(B(i.img,l[i.img.id]??"")),p.appendChild(document.createTextNode(b)),i.subtitle){const u=document.createElement("em");u.className=e.classes.tableCellSubtitle,u.innerText=l[i.subtitle]??"",p.appendChild(u)}if(i.link){const u=document.createElement("a");u.className=e.classes.tableCellLink,u.href=`${i.link.base?i.link.base:""}${l[i.link.id]}`,u.target=i.link.target??"_self",u.appendChild(p),c.appendChild(u)}else c.appendChild(p);i.suffix&&h!==""&&c.appendChild(e.safeHtml(i.suffix)),i.hideZeros&&h===0&&c.classList.add("hidden"),d.appendChild(c)}t.appendChild(d)}},w=(e,t)=>{const a=document.createElementNS("http://www.w3.org/2000/svg","svg"),n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttribute("href",`${e.base}${t}`),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",`#${t}`),e.class&&a.setAttribute("class",e.class),a.appendChild(n),a},B=(e,t)=>{const a=document.createElement("img");return a.setAttribute("src",`${e.base}${t}${e.ext??""}`),e.class&&a.setAttribute("class",e.class),a},D=(e,t,a,n)=>{if(t==""||typeof t==null)return"";if(a==="int")return new Intl.NumberFormat(n).format(t);if(a==="date"||a==="year"){if(a==="date"){const s=new Date(t);return new Intl.DateTimeFormat(n).format(s)}else if(a==="year"){const s=new Date(t,0,1);return new Intl.DateTimeFormat(n,{year:"numeric"}).format(s)}}return a==="bool"?t?e.checkMark:e.xMark:t},M={pagination:"",sortArrow:"",arrowUp:"absolute right-2 top-1.5 text-sm",arrowDown:"absolute right-2 bottom-1.5 text-sm",paginationButton:"w-auto h-10 px-4 inline-flex justify-center items-center border dark:border-stone-900",paginationButtonCurrent:"text-lg font-bold text-[#F8BB39]",paginationNav:"relative z-0 flex mt-4 justify-center rounded-md -space-x-px dark:text-[#f8f8f0]",paginationDescription:"text-center my-2 dark:text-[#f8f8f0] text-xs",paginationDescriptionStart:"text-[#F8BB39] text-xs",paginationDescriptionEnd:"text-[#F8BB39] text-xs",paginationDescriptionTotal:"text-[#F8BB39] text-xs",paginationNav:"",paginationTopArrow:"relative inline-flex justify-row items-center bg-white dark:bg-stone-700 px-2 h-12 dark:text-[#f8f8f0] focus:z-10",paginationTopSlash:"px-1",topPaginationNav:"relative flex items-center h-12 text-sm border-r-2 border-stone-200 dark:border-stone-950 dark:bg-stone-700 text-stone-800 dark:text-stone-300 placeholder-stone-800 dark:placeholder-stone-100",topPaginationCurrent:"flex flex-row text-sm font-bold text-center whitespace-no-wrap px-2",downloadWrapper:"relative border-r-2 border-stone-200 dark:border-stone-950",downloadButton:"relative inline-flex items-center bg-white dark:bg-stone-700 px-2 h-12 dark:text-[#f8f8f0] focus:z-10",downloadDropdown:"absolute left-0 z-50 -mr-1 mt-2 w-56 origin-top-right rounded-md bg-white dark:bg-stone-800 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none",downloadDropdownButton:"text-stone-700 dark:text-[#f8f8f0] hover:dark:bg-stone-900 hover:bg-stone-200 w-full block px-4 py-2 text-sm text-left",downloadDropdownInfo:"text-center text-xs text-stone-700 dark:text-[#f8f8f0] py-2",fieldsetWrap:"block mt-8 w-full bg-gray-200 dark:bg-stone-700 text-sm font-semibold p-3 text-stone-900 dark:text-[#f8f8f0] border-b border-stone-200 dark:border-stone-500 rounded-t-lg",fieldsetFilterWrap:"mb-4 dark:bg-stone-900 border border-stone-200 dark:border-stone-950 p-2",fieldset:"mb-4 dark:bg-stone-900 border border-stone-200 dark:border-stone-950 p-2",filterContainer:"hidden sm:flex flex-col lg:w-1/5 ltr:mr-4 rtl:ml-4",filterButton:"text-sm relative px-2 py-1 my-2 w-full flex flex-row justify-center cursor-pointer rounded-lg border dark:text-[#f8f8f0] dark:bg-stone-800 border-stone-200 dark:border-stone-500 shadow-sm",filterButtonActive:"bg-stone-400 dark:bg-stone-950 text-white border-stone-800",tableContainer:"flex flex-col w-full relative z-10 max-w-7xl mx-auto",tableColumn:"whitespace-nowrap px-3 py-2 text-sm text-stone-800 dark:text-[#f8f8f0] border border-stone-200 dark:border-stone-800 relative truncate max-w-[240px]",searchInput:"relative indent-6 block w-full h-12 px-4 text-sm dark:bg-stone-700 text-stone-800 dark:text-stone-300 placeholder-stone-800 dark:placeholder-stone-100 ltr:rounded-tl-xl rtl:rounded-tr-xl",searchIcon:"absolute block w-6 h-6 z-30 mt-3 mx-2 text-white",searchWrapper:"w-full h-12 flex-shrink border-r-2 border-stone-200 dark:border-stone-950",sizeSelectContainer:"h-12 w-36 relative",sizeSelect:"appearance-none w-full h-full bg-white dark:bg-stone-700 dark:text-[#f8f8f0] text-center rtl:rounded-tl-lg ltr:rounded-tr-lg",tableHeader:"flex flex-row mt-8 mb-0.5 h-12",tableCellLink:"text-[#F8BB39]",tableCellSubtitle:"block text-[#f8f8f0]",table:"w-full",thead:"bg-stone-100 dark:bg-stone-700",tbody:"divide-y divide-stone-200 dark:divide-stone-800 bg-white dark:bg-stone-800 border border-stone-500 dark:border-none",th:"relative px-1 py-3 rtl:pr-7 ltr:text-left rtl:text-right text-sm font-semibold text-stone-900 dark:text-[#f8f8f0] cursor-pointer",tr:"dark:even:bg-stone-900",td:"whitespace-nowrap px-3 py-2 text-sm text-stone-800 dark:text-[#f8f8f0] border border-stone-200 dark:border-stone-800 relative truncate max-w-[240px]"},A=(e={})=>{const t={...M};for(const a of Object.keys(e))a.startsWith("_")?t[a.substring(1)]=e[a]:t[a]=e[a];return t};function f(e,t={}){const a=document.createElement(e);for(const[n,s]of Object.entries(t))n==="style"&&typeof s=="object"?Object.assign(a.style,s):a[n]=s;return a}function x(e,t){if(!e.paginationNav){e.paginationNav=f("nav",{id:"paginationNav",className:e.classes.paginationNav||""});const a=f("div",{id:"paginationContainer",className:e.classes.tablePagination||""});a.appendChild(e.paginationNav),e.paginationDescription=f("div",{id:"paginationDescription",className:e.classes.paginationDescription||""}),a.appendChild(e.paginationDescription),t.appendChild(a)}v(e)}function $(e){return e.topPaginationNav||(e.topPaginationNav=f("nav",{id:"topPaginationNav",className:e.classes.topPaginationNav||""})),S(e),e.topPaginationNav}function S(e){var r;const t=e.topPaginationNav,a=Math.ceil(e.table.length/e.size);t.innerHTML="";const n=document.createDocumentFragment();e.currentPage>0&&!e.paginationArrowButtonsDisabled&&n.appendChild(y(e,"back","top"));const s=f("span",{innerHTML:`${e.numberFormatter.format(e.currentPage+1)} <span class="${e.classes.paginationTopSlash}">${((r=e.t)==null?void 0:r.of)??"/"}</span> ${e.numberFormatter.format(a)}`,className:e.classes.topPaginationCurrent||""});n.appendChild(s),e.currentPage<a-1&&!e.paginationArrowButtonsDisabled&&n.appendChild(y(e,"forward","top")),t.appendChild(n)}const v=e=>{var l,d,i,c;const t=e.paginationNav,a=Math.ceil(e.table.length/e.size);t.innerHTML="",e.paginationDescription.innerHTML="",S(e);const{paginationDescriptionStart:n,paginationDescriptionEnd:s,paginationDescriptionTotal:r}=e.classes;if(e.paginationDescription.innerHTML=`
        ${((l=e.t)==null?void 0:l.showing)??""} 
        <span class="${n}">${e.numberFormatter.format(e.currentPage*e.size+1)}</span>
        ${((d=e.t)==null?void 0:d.to)??"-"}
        <span class="${s}">${e.numberFormatter.format(Math.min((e.currentPage+1)*e.size,e.table.length))}</span>
        ${((i=e.t)==null?void 0:i.of)??"/"}
        <span class="${r}">${e.numberFormatter.format(e.table.length)}</span>
        ${((c=e.t)==null?void 0:c.entries)??""}
    `,a<=1)return;e.displayPages=F(e.currentPage,a,4);const o=document.createDocumentFragment();e.currentPage>0&&!e.paginationArrowButtonsDisabled&&o.appendChild(y(e,"back"));for(const h of e.displayPages)o.appendChild(P(e,h));e.currentPage<a-1&&!e.paginationArrowButtonsDisabled&&o.appendChild(y(e,"forward")),t.appendChild(o)};function y(e,t,a="bottom"){const n=a=="top"?e.classes.paginationTopArrow:[e.classes.paginationButton,e.classes.paginationArrow||""].join(" ");return f("button",{textContent:t==="back"?"<":">",className:n,onclick:()=>{e.currentPage+=t==="back"?-1:1,e.updateTable(),v(e)}})}function P(e,t){return t==="..."?f("span",{textContent:"...",className:e.classes.paginationButton}):f("button",{textContent:e.numberFormatter.format(t+1),className:[e.classes.paginationButton,e.currentPage===t?e.classes.paginationButtonCurrent:""].join(" "),onclick:()=>{e.currentPage=t,e.updateTable(),v(e)}})}function F(e,t,a){const n=[],s=Math.max(e-a,0),r=Math.min(e+a,t-1);s>1?n.push(0,"..."):s===1&&n.push(0);for(let o=s;o<=r;o++)n.push(o);return r<t-2?n.push("...",t-1):r===t-2&&n.push(t-1),n}function L(e){var s;const t=f("label",{className:e.classes.searchWrapper}),a=f("input",{type:"search",id:"fuzzy_search",placeholder:((s=e.t)==null?void 0:s.search_placeholder)??"Search",className:e.classes.searchInput});a.oninput=()=>E(e),e.searchBox=a;const n=f("span",{className:e.classes.searchIcon,innerHTML:`
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="icon">
                <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
            </svg>`});return t.append(n,a),t}function E(e){const t=e.searchBox.value.trim();let a=t!==""?j(e,t):e.data;for(const n of e.filters)for(const s of n.options.filter(r=>r.active))a=a.filter(r=>{const o=s.value.test(r[n.filterColumn]);return s.active=!0,s.inverse?!o:o});e.table=a,e.currentPage=0,e.updateTable(),x(e)}function j(e,t){var l,d;const n=((l=e.config)==null?void 0:l.similarityThreshold)||.9,s=((d=e.config)==null?void 0:d.exactMatchBonus)||.5,r=t.toLowerCase(),o=[];for(const i of e.data){let c=0,h=!1;for(const b of Object.values(i)){if(b==null)continue;const p=String(b).toLowerCase();if(p.includes(r)){h=!0;const u=1-p.indexOf(r)/p.length;c=Math.max(c,.8+u*.2)}else if(p.length>r.length){const u=p.split(/\s+/);for(const N of u)c=Math.max(c,T(N,r,.1))}else c=Math.max(c,T(p,r,.1))}h&&(c=Math.min(c+s,1)),c>=n&&o.push({item:i,score:c})}return o.sort((i,c)=>c.score-i.score).map(i=>i.item)}function T(e,t,a=.1){if(e===t)return 1;if(!e.length||!t.length)return 0;const n=Math.max(Math.floor(Math.max(e.length,t.length)/2)-1,0),s=new Array(t.length).fill(!1),r=[],o=[];for(let p=0;p<e.length;p++){const u=Math.max(0,p-n),N=Math.min(p+n+1,t.length);for(let k=u;k<N;k++)if(!s[k]&&e[p]===t[k]){r.push(e[p]),o.push(t[k]),s[k]=!0;break}}const l=r.length;if(l===0)return 0;let d=0;for(let p=0;p<l;p++)r[p]!==o[p]&&d++;const i=(l/e.length+l/t.length+(l-d/2)/l)/3;let c=0;const b=Math.min(4,e.length,t.length);for(let p=0;p<b&&e[p]===t[p];p++)c++;return i+c*a*(1-i)}function I(e){if(e.aside){const t=f("aside",{innerHTML:e.aside});e.container.appendChild(t)}if(e.filters.length>0){const t=f("div",{className:e.classes.filterContainer,id:"fuzzy_filters"});e.filters.forEach((a,n)=>{const s=f("div",{className:e.classes.fieldsetWrap,textContent:a.name});t.appendChild(s);const r=W(a,n,z,e);t.appendChild(r)}),e.container.appendChild(t)}}function H(e,t,a,n){const s=document.createDocumentFragment();e.icon&&s.appendChild(w(e.icon,a.code??"")),s.appendChild(document.createTextNode(a.title??""));const r=f("button",{className:`${t.filterButton} ${a.active?t.filterButtonActive:""}`,onclick:n});return r.appendChild(s),r}function W(e,t,a,n){const s=f("fieldset",{className:n.classes.fieldset});return e.options.forEach((r,o)=>{const l=H(e,n.classes,r,()=>a(n,t,o));s.appendChild(l)}),s}function z(e,t,a){e.filters[t].options[a].active=e.filters[t].options[a].values!=="",e.filters[t].filterType==="radio"&&e.filters[t].options.forEach((o,l)=>{l!==a&&(o.active=!1)}),E(e);const n=document.getElementById("fuzzy_filters");if(!n)return;const s=Array.from(n.querySelectorAll("fieldset")),r=e.classes.filterButtonActive.trim().replace(/\s+/g," ").split(" ");e.filters.forEach((o,l)=>{const d=s[l];d&&o.options.forEach((i,c)=>{const h=d.children[c];h&&r.forEach(b=>{i.active?h.classList.add(b):h.classList.remove(b)})})})}function O(e){const t=f("details",{id:"fuzzy_download_details",className:e.classes.downloadWrapper}),a=f("summary",{className:e.classes.downloadButton}),n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("fill","none"),n.setAttribute("viewBox","0 0 24 24"),n.setAttribute("stroke-width","1.5"),n.setAttribute("stroke","currentColor"),n.setAttribute("class","w-6 h-6"),n.innerHTML='<path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />',a.appendChild(n);const s=f("div",{className:e.classes.downloadDropdown,innerHTML:`<p class="${e.classes.downloadDropdownInfo}">(Download current filtered dataset)</p>`});for(const r of["CSV","Excel","TSV","JSON"]){const o=f("button",{className:e.classes.downloadDropdownButton,textContent:r,onclick:()=>_(e.table,r)});s.appendChild(o)}return t.appendChild(a),t.appendChild(s),document.addEventListener("click",r=>{!t.contains(r.target)&&t.hasAttribute("open")&&t.removeAttribute("open")}),t}function _(e,t){const a=(d,i)=>{const c=Object.keys(d[0]).join(i),h=d.map(b=>Object.values(b).join(i)).join(`
`);return`${c}
${h}`};let n,s,r;switch(t){case"TSV":n="text/tab-separated-values",s="data.tsv",r=a(e,"	");break;case"CSV":n="text/csv",s="data.csv",r=a(e,",");break;case"Excel":n="application/vnd.ms-excel",s="data.xls",r=`<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta charset="UTF-8"><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>Sheet1</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table><thead><tr>${Object.keys(e[0]).map(d=>`<th>${d}</th>`).join``}</tr></thead><tbody>${e.map(d=>`<tr>${Object.values(d).map(i=>`<td>${i}</td>`).join``}</tr>`).join``}</tbody></table></body></html>`;break;default:n="application/json",s="data.json",r=JSON.stringify(e,null,2);break}const o=new Blob([r],{type:n}),l=document.createElement("a");l.download=s,l.href=URL.createObjectURL(o),document.body.appendChild(l),l.click(),document.body.removeChild(l)}function U(e){const t=f("div",{className:e.classes.sizeSelectContainer??""}),a=f("label",{htmlFor:"fuzzy_size_select",className:"sr-only",textContent:"Select Page Size"});t.appendChild(a);const n=f("select",{id:"fuzzy_size_select",className:e.classes.sizeSelect||""});t.appendChild(n);const s=new Intl.NumberFormat(e.locale);for(const r of e.pageSizes){const o=f("option",{value:r,textContent:s.format(r)});r===e.size&&(o.selected=!0),n.appendChild(o)}return n.value=e.size,n.addEventListener("change",r=>{e.size=r.target.value,e.currentPage=0,e.paginationUpdate(),e.updateTable()}),t}class J{constructor(t,a,n,s){C(this,"render",()=>{this.container.innerHTML="",I(this);const t=document.createElement("div");t.className=this.classes.tableContainer;const a=document.createElement("div");a.className=this.classes.tableHeader,a.appendChild(L(this)),a.appendChild($(this)),a.appendChild(O(this)),a.appendChild(U(this));const n=document.createElement("table");n.className=this.classes.table;const s=document.createElement("thead");if(this.classes.thead&&(s.className=this.classes.thead),this.numberCol){const o=document.createElement("th");o.className=`${this.classes.th??""} number-column`,o.textContent="#",s.appendChild(o)}for(const o of this.head){const l=document.createElement("th");l.className=`${this.classes.th??""} ${o.class??""}`,l.innerHTML=o.name;const d=document.createElement("span"),i=document.createElement("span");d.className=this.classes.arrowUp,i.className=this.classes.arrowDown,d.textContent="▲",i.textContent="▼",d.style.opacity=o.sortDir=="ascending"?1:.35,i.style.opacity=o.sortDir=="descending"?1:.35,l.appendChild(d),l.appendChild(i),l.addEventListener("click",()=>{for(const h of document.querySelectorAll("th span"))h.style.opacity=.35;l.classList.toggle("ascending")?(d.style.opacity=1,i.style.opacity=.35):(i.style.opacity=1,d.style.opacity=.35),this.table=g(this,o),this.updateTable()}),s.appendChild(l)}n.appendChild(s);const r=document.createElement("tbody");r.id="fuzzy-rows",this.classes.tbody&&(r.className=this.classes.tbody),m(this,r),n.appendChild(r),t.appendChild(a),t.appendChild(n),x(this,t),this.container.append(t),this.filters.forEach((o,l)=>{o.options.forEach((d,i)=>{d.active&&z(this,l,i)})})});C(this,"safeHtml",t=>{const a=document.createElement("div");a.innerHTML=t;for(const n of["script","iframe","link","style","object","embed"]){const s=a.getElementsByTagName(n);for(let r=s.length-1;r>=0;r--)s[r].parentNode.removeChild(s[r])}return a.firstChild});C(this,"paginationUpdate",()=>v(this));C(this,"updateTable",()=>m(this,document.getElementById("fuzzy-rows")));var r,o,l,d,i,c,h,b,p,u;this.container=document.getElementById(t),a?(this.data=[...a],this.table=[...a]):(this.data=[...JSON.parse(this.container.dataset.rows)],this.table=[...JSON.parse(this.container.dataset.rows)]),this.searchBox,this.query="",this.sortedCol="",this.filters=s.filters??[],this.head=n,n?this.head=n:this.head=[...JSON.parse(this.container.dataset.head)],this.filteredTable=[],this.size=s.pageSize??((o=(r=this.container)==null?void 0:r.dataset)==null?void 0:o.pageSize)??100,this.currentPage=0,this.numberCol=s.numberCol??!1,this.pageSizes=s.pageSizes??((d=(l=this.container)==null?void 0:l.dataset)==null?void 0:d.pageSizes)??[50,100,250,1e3,5e3],this.paginationArrowButtonsDisabled=s==null?void 0:s.paginationArrowButtonsDisabled,this.classes=A(s.classes),this.aside=s.aside??((c=(i=this.container)==null?void 0:i.dataset)==null?void 0:c.aside),this.checkMark=(s==null?void 0:s.checkMark)??((b=(h=this.container)==null?void 0:h.dataset)==null?void 0:b.checkMark)??"✓",this.xMark=(s==null?void 0:s.xMark)??((u=(p=this.container)==null?void 0:p.dataset)==null?void 0:u.xMark)??"✗",this.locale=s.locale??"en",this.numberFormatter=new Intl.NumberFormat(this.locale),this.t=s.t??{search_placeholder:"Search"},this.vernacularNumerals=s.vernacularNumerals??!0,this.render()}setData(t){this.update(()=>{this.data=t,this.table=t,this.filteredTable=t.filter(()=>!0)})}}return J});
